image: registry.gitlab.com/remche/docker-yade
stages:
  - cmake
  - build
  - install
  - test

cmake:
  stage: cmake
  script:
    - mkdir build && cd build
    - cmake -DSUFFIX=-ci -DCMAKE_VERBOSE_MAKEFILE=ON -DCMAKE_INSTALL_PREFIX=/install ..
  artifacts:
    paths:
      - build
      
make:
  stage: build
  script:
    - cd build
    - make -j 16
  artifacts:
    paths:
      - build
  dependencies: 
    - cmake      

install:
  stage: install
  script:
    - cd build
    - make install
  artifacts:
    paths:
      - /install
  dependencies: 
    - make

test:
  stage: test
  script:
    - /install/bin/yade-ci --test
  dependencies:
    - install


check:
  stage: test
  script:
    - /install/bin/yade-ci --checks
  dependencies:
    - install


