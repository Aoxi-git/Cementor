#mpiexec -n 2 python test.py
import sys
from os.path import expanduser
sys.path.append(expanduser('~')+'/yade/bin') # path where you have yadeimport.py
# yadeimport.py is generated by `ln yade-versionNo yadeimport.py`, where yade-versionNo is the yade executable
print expanduser('~')+'/yade/bin'
from mpi4py import MPI

comm = MPI.COMM_WORLD
rank = comm.Get_rank()



if rank == 0:
    import yadeimport as yade
    for i in range(4):
	    for j in range(2):
		    yade.Omega().bodies.append(yade.sphere((i+j/3.,j,0),0.5))
    
    comm.send(yade.Body(), dest=1, tag=10)
    comm.send(yade.Omega().sceneToString(), dest=1, tag=12) 

elif rank == 1:
    import yadeimport as yade
    randomBody = comm.recv(source=0, tag=10)
    yade.Omega().stringToScene(comm.recv(source=0, tag=12))
    O=yade.Omega()
    print "received",len(O.bodies),"bodies"
    

#ISSUE:
    #comm.send(yade.Scene(), dest=1, tag=12) 
  #File "MPI/Comm.pyx", line 1130, in mpi4py.MPI.Comm.send (src/mpi4py.MPI.c:94609)
  #File "MPI/msgpickle.pxi", line 187, in mpi4py.MPI.PyMPI_send (src/mpi4py.MPI.c:35845)
  #File "MPI/msgpickle.pxi", line 88, in mpi4py.MPI._p_Pickle.dump (src/mpi4py.MPI.c:34491)
#TypeError: No to_python (by-value) converter found for C++ type: std::__cxx11::list<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > >
